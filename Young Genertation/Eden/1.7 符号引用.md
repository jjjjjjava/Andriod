[toc]

### 符号引用解析过程与缓存

1. **符号引用在运行时常量池中的存储**：
   - 符号引用在类加载时从类文件常量池被读取并存储在运行时常量池中。此时，它们只是未解析的符号。
2. **符号引用解析**：
   - 当代码第一次使用符号引用时，JVM会查找和解析这个符号引用，将其转换为直接引用。这包括查找类、方法或字段的实际内存地址。
3. **缓存解析结果**：
   - 解析后的结果通常会被缓存，以便后续使用时无需再次解析。
   - 这个缓存机制通常并不是简单地存储在原始的符号引用位置，而是存储在类的元数据结构中。

### 示例代码解析

考虑以下代码：

```java
public class Example {
    public void printHello() {
        System.out.println("Hello, world!");
    }
}
```

当JVM加载并解析这个类时：

1. **类加载和符号引用存储**：
   - JVM加载 `Example` 类，并将 `printHello` 方法和 `System.out.println` 方法的符号引用存储在运行时常量池中。
2. **符号引用解析**：
   - 当代码第一次调用 `printHello` 方法时，JVM会查找 `printHello` 的符号引用并解析它。
   - 解析过程包括找到 `printHello` 方法的具体实现并将其转换为方法的直接引用。
3. **缓存解析结果**：
   - 解析后的方法引用（如 `printHello` 的内存地址）会被缓存。这个缓存通常存储在 `Example` 类的元数据结构中，而不是运行时常量池中的原始符号引用位置。
   - 类似地，`System.out` 和 `println` 方法的解析结果也会被缓存。

### 具体的数据结构

- **类元数据结构**：类加载器会维护每个加载类的元数据结构，这些结构包括方法表、字段表等。当符号引用被解析时，解析结果会存储在这些结构中，以便快速访问。
- **运行时常量池**：原始的符号引用仍然保留在运行时常量池中，但解析后的直接引用不存储在其中，而是存储在类的元数据结构中。