[toc]

## 1. 数据存储

![image-20240521115036688](../Pic/image-20240521115036688.png)

### 1. SharedPreferences

#### 说明

- **存储方式**：在键值对中存储私有原始数据（如布尔值、浮点数、整数、字符串和字符串集）。
- **用途**：适用于存储少量的简单数据，如用户设置、应用配置等。

#### 使用场景示例

- 保存用户偏好设置：
  - 应用中的主题选择（如深色模式或浅色模式）。
  - 语言设置。

#### 示例

```java
// 保存数据
SharedPreferences sharedPref = getSharedPreferences("MyPrefs", Context.MODE_PRIVATE);
SharedPreferences.Editor editor = sharedPref.edit();
editor.putString("key_name", "value");
editor.apply();

// 读取数据
SharedPreferences sharedPref = getSharedPreferences("MyPrefs", Context.MODE_PRIVATE);
String value = sharedPref.getString("key_name", "default_value");
```

### 2. 内部存储

#### 说明

- **存储方式**：在设备内存中存储私有数据，文件对应用程序是私有的，其他应用无法访问。
- **用途**：适用于存储应用的私有数据，如配置文件、缓存数据等。

#### 使用场景示例

- 保存缓存文件：
  - 在应用启动时下载并保存一些配置文件或图像文件。

#### 示例

```java
// 写入文件
String filename = "myfile.txt";
String fileContents = "Hello, World!";
FileOutputStream fos = openFileOutput(filename, Context.MODE_PRIVATE);
fos.write(fileContents.getBytes());
fos.close();

// 读取文件
FileInputStream fis = openFileInput(filename);
InputStreamReader isr = new InputStreamReader(fis);
BufferedReader bufferedReader = new BufferedReader(isr);
StringBuilder sb = new StringBuilder();
String line;
while ((line = bufferedReader.readLine()) != null) {
    sb.append(line);
}
fis.close();
String fileContents = sb.toString();
```

### 3. 外部存储

#### 说明

- **存储方式**：在共享的外部存储中存储公共数据。外部存储对所有应用程序可见，需要处理存储权限。
- **用途**：适用于存储公共数据，如图片、视频、音频文件等。

#### 使用场景示例

- 保存照片或视频：
  - 拍照应用保存拍摄的照片到公共图片目录。

#### 示例

```java
// 检查存储权限
if (ContextCompat.checkSelfPermission(this, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED) {
    ActivityCompat.requestPermissions(this, new String[]{Manifest.permission.WRITE_EXTERNAL_STORAGE}, 1);
}

// 写入文件
String filename = "myfile.txt";
String fileContents = "Hello, World!";
File file = new File(Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DOCUMENTS), filename);
FileOutputStream fos = new FileOutputStream(file);
fos.write(fileContents.getBytes());
fos.close();

// 读取文件
FileInputStream fis = new FileInputStream(file);
InputStreamReader isr = new InputStreamReader(fis);
BufferedReader bufferedReader = new BufferedReader(isr);
StringBuilder sb = new StringBuilder();
String line;
while ((line = bufferedReader.readLine()) != null) {
    sb.append(line);
}
fis.close();
String fileContents = sb.toString();
```

### 4. SQLite 数据库

#### 说明

- **存储方式**：在私有数据库中存储结构化数据。数据库对应用程序是私有的，其他应用无法访问。
- **用途**：适用于存储复杂的结构化数据，如用户信息、订单记录等。

#### 使用场景示例

- 管理用户数据：
  - 应用中的用户信息、订单记录等。

#### 示例

##### 创建数据库助手类

```java
public class DatabaseHelper extends SQLiteOpenHelper {

    private static final String DATABASE_NAME = "mydatabase.db";
    private static final int DATABASE_VERSION = 1;
    private static final String TABLE_NAME = "mytable";
    private static final String COLUMN_ID = "_id";
    private static final String COLUMN_NAME = "name";

    public DatabaseHelper(Context context) {
        super(context, DATABASE_NAME, null, DATABASE_VERSION);
    }

    @Override
    public void onCreate(SQLiteDatabase db) {
        String CREATE_TABLE = "CREATE TABLE " + TABLE_NAME + " (" +
                COLUMN_ID + " INTEGER PRIMARY KEY AUTOINCREMENT, " +
                COLUMN_NAME + " TEXT)";
        db.execSQL(CREATE_TABLE);
    }

    @Override
    public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {
        db.execSQL("DROP TABLE IF EXISTS " + TABLE_NAME);
        onCreate(db);
    }
}
```

##### 使用数据库助手类

```java
// 插入数据
DatabaseHelper dbHelper = new DatabaseHelper(this);
SQLiteDatabase db = dbHelper.getWritableDatabase();
ContentValues values = new ContentValues();
values.put("name", "John Doe");
long newRowId = db.insert("mytable", null, values);

// 查询数据
SQLiteDatabase db = dbHelper.getReadableDatabase();
String[] projection = { "_id", "name" };
Cursor cursor = db.query("mytable", projection, null, null, null, null, null);
while (cursor.moveToNext()) {
    long itemId = cursor.getLong(cursor.getColumnIndexOrThrow("_id"));
    String itemName = cursor.getString(cursor.getColumnIndexOrThrow("name"));
    // 处理数据
}
cursor.close();
```

### 总结

1. **SharedPreferences**：用于存储简单的键值对数据，适合保存用户设置和应用配置。
2. **内部存储**：用于存储私有数据，文件对应用程序是私有的，其他应用无法访问。
3. **外部存储**：用于存储公共数据，文件对所有应用程序可见，适合存储大文件，如图片和视频。
4. **SQLite 数据库**：用于存储复杂的结构化数据，适合需要关系型数据库管理的数据存储。