[toc]

## 进程的生命周期

#### 1. 前台进程

前台进程是系统优先级最高的进程，因为它直接影响用户体验。通常只有少数几个前台进程在运行。下面是前台进程所包含的任务和活动。

- **托管用户正在交互的 Activity**：例如用户当前正在使用的 Activity，它的 `onResume()` 方法已经被调用。
- **托管绑定到用户正在交互的 Activity 的 Service**：例如绑定到正在交互的 Activity 的服务。
- **托管正在“前台”运行的 Service**：服务通过 `startForeground()` 方法启动，并在前台运行。
- **托管正在执行生命周期回调的 Service**：例如 `onCreate()`、`onStart()` 或 `onDestroy()` 方法正在执行的服务。
- **托管正在执行 `onReceive()` 方法的 BroadcastReceiver**：例如正在处理广播接收的 `BroadcastReceiver`。

#### 2. 可见进程

可见进程虽然不在前台，但对用户依然可见，因此系统优先级略低于前台进程。

- **托管不在前台但仍对用户可见的 Activity**：例如调用了 `onPause()` 方法，但仍部分可见的 Activity。
- **托管绑定到可见（或前台）Activity 的 Service**：例如绑定到可见 Activity 的服务。

#### 3. 服务进程

服务进程是指正在运行已使用 `startService()` 方法启动的服务，但不属于前台或可见进程类别的进程。

- **正在运行已使用 `startService()` 方法启动的服务**：这些服务通常执行一些后台任务，例如下载文件或播放音乐。

#### 4. 后台进程

后台进程是指包含目前对用户不可见的 Activity 的进程，这些 Activity 的 `onStop()` 方法已经被调用。

- **包含目前对用户不可见的 Activity 的进程**：这些进程通常保存在 LRU（最近最少使用）列表中，以便在需要时可以快速恢复。

#### 5. 空进程

空进程是不含任何活动应用组件的进程。保留这种进程的唯一目的是用作缓存，以缩短下次在其中运行组件所需的启动时间。

- **不含任何活动应用组件的进程**：这些进程没有任何活动的组件，但保留它们可以加快下次启动的速度。

### 优先级管理和进程终止

- **前台进程**：优先级最高，系统会尽量避免终止这些进程，除非绝对必要。
- **可见进程**：优先级次高，系统在内存不足时会优先终止这些进程。
- **服务进程**：优先级中等，系统在内存不足时会终止这些进程以释放资源。
- **后台进程**：优先级较低，系统会根据 LRU 列表顺序终止这些进程。
- **空进程**：优先级最低，系统通常会首先终止这些进程以释放内存。

### 示例情景

假设用户打开了一个音乐播放器应用，音乐播放器包括以下组件：

1. **MainActivity**：用户界面，展示当前播放的音乐。
2. **MusicService**：后台服务，负责播放音乐。
3. **NotificationReceiver**：广播接收器，处理音乐控制通知。

应用在运行中的状态和进程优先级如下：

- **前台进程**：

  - `MainActivity` 正在前台与用户交互。
  - `MusicService` 通过 `startForeground()` 方法运行在前台。
  - `NotificationReceiver` 正在处理用户通过通知栏发来的控制命令。

- **可见进程**：

  - 用户打开了音乐播放器的设置对话框，`MainActivity` 进入 `onPause()` 状态，但仍部分可见。

- **服务进程**：

  - 音乐播放器的后台服务 `MusicService` 正在播放音乐，但应用界面已经关闭，服务依然在后台运行。

- **后台进程**：

  - 用户切换到其他应用，音乐播放器的 `MainActivity` 进入 `onStop()` 状态，成为后台进程。

- **空进程**：

  - 音乐播放器的其他组件不再运行，系统可能会将其保留为空进程，以便快速恢复。

  

## 详解

1. 前台进程：
   1. **托管用户正在交互的 Activity**（已调用 Activity 的 `onResume()` 方法）：
      - 这表示当前用户正在与该 Activity 进行交互。
      - 当一个 Activity 调用了 `onResume()` 方法时，它进入了前台，并成为用户当前正在使用的界面。
      - 例如，用户打开了一个聊天应用，并正在阅读或发送消息，这个聊天界面的 Activity 就处于前台进程中。
   2. **托管某个 Service，后者绑定到用户正在交互的 Activity**：
      - 这表示有一个 Service 与正在交互的 Activity 绑定在一起。
      - 例如，一个音乐播放器应用，用户正在与播放器界面交互，同时播放器界面绑定了一个用于播放音乐的 Service，这个 Service 也会被视为前台进程的一部分。
   3. **托管正在“前台”运行的 Service**（服务已调用 `startForeground()`）：
      - 这表示一个 Service 被提升为前台服务。
      - 使用 `startForeground()` 方法启动的服务会显示一个持续的通知，告知用户该服务正在运行，这使得服务更不容易被系统终止。
      - 例如，导航应用在进行导航时，会使用前台服务来确保导航持续进行，并在通知栏中显示导航信息。
   4. **托管正执行一个生命周期回调的 Service**（`onCreate()`、`onStart()` 或 `onDestroy()`）：
      - 这表示一个 Service 正在执行其生命周期回调方法。
      - 当 Service 的 `onCreate()`、`onStart()` 或 `onDestroy()` 方法正在运行时，系统会将其视为前台进程的一部分，以确保这些关键操作能够完成。
      - 例如，一个后台下载服务在启动时，会执行 `onCreate()` 和 `onStart()` 方法来初始化和开始下载任务。
   5. **托管正执行其 `onReceive()` 方法的 BroadcastReceiver**：
      - 这表示一个 BroadcastReceiver 正在处理接收到的广播消息。
      - 当 BroadcastReceiver 的 `onReceive()` 方法被调用时，它正在执行一个短暂的任务，通常用于处理系统或应用发出的广播事件。
      - 例如，收到短信的广播接收器在接收到新短信时会触发 `onReceive()` 方法来处理消息通知。