[toc]

## BroadcastReceiver

**BroadcastReceiver** 是 Android 中的一个组件，它允许应用程序接收并响应系统或其他应用程序发出的广播消息。广播消息可以是系统广播（例如电池电量低、网络状态变化等）或者应用内广播（例如数据下载完成、用户登录成功等）。

### BroadcastReceiver 的用途

- **系统广播**：监听系统事件，如设备启动、时间变化、语言变化等。
- **应用内广播**：在应用程序内部组件之间传递消息。

### 声明 BroadcastReceiver

#### 1. 在 AndroidManifest.xml 中声明（适用于部分广播）

在 AndroidManifest.xml 中声明一个 BroadcastReceiver，并指定它应该接收的广播消息类型。

```
xml复制代码<receiver android:name=".MyBroadcastReceiver">
    <intent-filter>
        <action android:name="android.intent.action.BOOT_COMPLETED" />
    </intent-filter>
</receiver>
```

#### 2. 动态注册 BroadcastReceiver

在代码中动态注册 BroadcastReceiver，可以在需要时注册，在不需要时注销。这种方法通常用于应用程序运行时需要监听的广播。

```
java复制代码BroadcastReceiver myReceiver = new MyBroadcastReceiver();
IntentFilter filter = new IntentFilter("android.intent.action.BOOT_COMPLETED");
registerReceiver(myReceiver, filter);

// 在不需要时注销广播接收器
unregisterReceiver(myReceiver);
```

### 注意事项

#### 从 Android 8.0 (API level 26) 开始的限制

从 Android 8.0 开始，应用程序不能再在其 AndroidManifest.xml 文件中声明大多数隐式广播接收器。这是为了提高系统的效率和电池寿命。以下是几个例外，可以在 AndroidManifest.xml 中声明的必要广播：

- `ACTION_BOOT_COMPLETED`
- `ACTION_TIME_SET`
- `ACTION_LOCALE_CHANGED`
- 其他少数几种广播

对于其他类型的广播，您需要在代码中动态注册接收器。

### 使用 LocalBroadcastManager

`LocalBroadcastManager` 是一个在应用程序内部发送和接收广播消息的类，它不会跨越应用程序边界，因而更加高效和安全。

#### 使用 LocalBroadcastManager 发送和接收广播

1. **注册 BroadcastReceiver**

```
java复制代码LocalBroadcastManager localBroadcastManager = LocalBroadcastManager.getInstance(this);
IntentFilter filter = new IntentFilter("com.example.ACTION");
localBroadcastManager.registerReceiver(myReceiver, filter);
```

1. **发送广播**

```
java复制代码Intent intent = new Intent("com.example.ACTION");
LocalBroadcastManager.getInstance(this).sendBroadcast(intent);
```

1. **创建 BroadcastReceiver**

```
java复制代码public class MyBroadcastReceiver extends BroadcastReceiver {
    @Override
    public void onReceive(Context context, Intent intent) {
        // 处理接收到的广播
    }
}
```



## 注册过程

#### 1. 概览

BroadcastReceiver的注册分为两种方式：静态注册和动态注册。

- **静态注册**：在`AndroidManifest.xml`中声明，这种方式适用于一些系统广播，如设备启动完成。
- **动态注册**：在代码中注册和注销，这种方式适用于应用运行时需要监听的广播。

#### 2. 流程图解

##### 静态注册

```
plaintext复制代码1. AndroidManifest.xml
    |
    |--> 声明BroadcastReceiver
    |
2. 系统广播
    |
    |--> 触发BroadcastReceiver
    |
3. BroadcastReceiver
    |
    |--> onReceive()方法执行
```

##### 动态注册

```
1. Activity/Service
    |
    |--> 注册BroadcastReceiver
    |    |
    |    |--> registerReceiver()
    |
2. 系统广播
    |
    |--> 触发BroadcastReceiver
    |
3. BroadcastReceiver
    |
    |--> onReceive()方法执行
    |
4. Activity/Service
    |
    |--> 注销BroadcastReceiver
         |
         |--> unregisterReceiver()
```