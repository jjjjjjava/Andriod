[toc]

## 启动模式

Android 中的启动模式（Launch Modes）和 Intent 标志（Intent Flags）用于控制 Activity 的启动行为和任务堆栈管理。

启动模式（Launch Modes）指的是当启动一个新的 Activity 时，系统如何管理该 Activity 及其所在的任务栈。



### 启动模式（Launch Modes）

1. **standard**
   - **说明**：系统在启动它的任务中创建 Activity 的新实例。每次启动 Activity 都会创建一个新的实例。
   - **使用场景**：适用于大多数普通 Activity。例如，用户从主界面启动一个新的详情页。
2. **singleTop**
   - **说明**：如果 Activity 的实例已经存在于当前任务的顶部，系统会通过调用其 `onNewIntent()` 方法来重用该实例，否则会创建一个新实例。
   - **使用场景**：适用于避免重复创建实例的场景。例如，用户连续点击通知消息，希望在已有的详情页面上显示新消息内容。
3. **singleTask**
   - **说明**：系统创建一个新任务（Task）并在任务的根目录下实例化 Activity。如果 Activity 的实例已存在于单独的任务中，则调用其 `onNewIntent()` 方法，并移除其其它的所有实例。一次只能存在一个 Activity 实例。
   - **使用场景**：适用于启动特定任务时需要独立的任务栈的场景。例如，启动一个搜索页面，不论用户从哪里点击搜索，都只有一个搜索页面实例。
4. **singleInstance**
   - **说明**：类似于 `singleTask`前半部分，但 Activity 始终是其任务的唯一成员。任何由此 Activity 启动的 Activity 都会在一个单独的任务中打开。
   - **使用场景**：适用于非常特殊的场景，例如启动一个浮动窗口 Activity，确保它始终在单独的任务中运行，不与其他 Activity 混合。

### Intent 标志（Intent Flags）

Intent 标记用于修改 Activity 启动行为，与启动模式结合使用，可以实现更灵活的导航控制。

1. **FLAG_ACTIVITY_NEW_TASK**
   - **说明**：同 `singleTask`，启动一个新任务并在任务的根目录下实例化 Activity。如果 Activity 已存在于单独的任务中，则调用其 `onNewIntent()` 方法。
   - **使用场景**：用于启动一个新的任务栈。例如，从一个服务启动一个新界面。
2. **FLAG_ACTIVITY_SINGLE_TOP**
   - **说明**：同 `singleTop`，如果 Activity 的实例已经存在于当前任务的顶部，系统会通过调用其 `onNewIntent()` 方法来重用该实例 (将新的 Intent 传递给已有的实例)，否则会创建一个新实例。
   - **使用场景**：适用于避免重复创建栈顶 Activity 的场景。
3. **FLAG_ACTIVITY_CLEAR_TOP**
   - **说明**：如果正在启动的 Activity 已在当前任务中运行，则不会启动该 Activity 的新实例，而是销毁其上的所有 Activity，并调用其 `onNewIntent()` 方法。
   - **使用场景**：适用于清除任务栈中重复的 Activity 实例。例如，用户从某个详情页面返回到主页面，希望清除中间的所有页面。

### 例子

假设我们有一个 Activity 栈：`DetailActivity -> MainActivity -> DetailActivity -> SettingsActivity`，

我们启动一个新的 `MainActivity`：

1. **standard**：这是默认的启动模式。在这种模式下，每次启动一个 Activity 都会创建它的一个新实例，无论栈中是否已经存在该 Activity 的实例。

   - 启动后，栈变为：`MainActivity -> DetailActivity -> SettingsActivity -> MainActivity`。

2. **singleTop**：如果所启动的 Activity 已经位于任务栈的栈顶，则重用栈顶的 Activity 实例，并调用其 `onNewIntent()` 方法；否则，创建新的实例。

   ```
   DetailActivity -> MainActivity -> DetailActivity -> SettingsActivity -> MainActivity
   ```

3. #### **`singleTask` ：如果所启动的 Activity 已经存在于任务栈中，则该 Activity 及其上的所有 Activity 实例被清除，只保留该 Activity 实例，并调用其 `onNewIntent()` 方法。

   ```
   MainActivity
   ```

4. **singleInstance**：创建一个新的任务栈，并在里面创建新的activity。

   ```
   (任务栈1) DetailActivity -> MainActivity -> DetailActivity -> SettingsActivity
   (任务栈2) MainActivity
   ```

5. **FLAG_ACTIVITY_NEW_TASK:同 `singleTask`

6. **FLAG_ACTIVITY_SINGLE_TOP**:同：singleTop

7. **FLAG_ACTIVITY_CLEAR_TOP**：如果任务栈中已经存在所启动的 Activity，则会清除该 Activity 及其上的所有 Activity 实例，并启动该 Activity 的新实例。

   ```
   DetailActivity -> MainActivity
   ```

   

